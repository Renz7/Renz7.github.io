<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://renz7.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://renz7.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://renz7.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://renz7.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://renz7.github.io/css/light.css' />
    <link rel="stylesheet" href='https://renz7.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://renz7.github.io/css/syntax.css' />
    <title>2023-12-12 ES ILM - Ren7&#39;s daily note.</title>
    
    <link rel="icon" type="image/x-icon" href='https://avatars.githubusercontent.com/u/18676245'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="2023-12-12 ES ILM Index Lifecycle Management 索引生命周期管理 (ILM) 是在 Elasticsearch 6.6（公测版）首次引入并在 6.7 版正式推出的一项功能。ILM 是 Elasticsearch 的一部分，主要用来管理索引 ​​ 标记节点属性" />
<meta name="keywords"
  content='blog,python,golang,java,k8s,backend' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://renz7.github.io/post/20231212-es-ilm-z1idtm2.html" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="2023-12-12 ES ILM - Ren7&#39;s daily note." />
<meta name="twitter:description"
  content="2023-12-12 ES ILM Index Lifecycle Management 索引生命周期管理 (ILM) 是在 Elasticsearch 6.6（公测版）首次引入并在 6.7 版正式推出的一项功能。ILM 是 Elasticsearch 的一部分，主要用来管理索引 ​​ 标记节点属性" />
<meta name="twitter:site" content="https://renz7.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://renz7.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="2023-12-12 ES ILM - Ren7&#39;s daily note.">
<meta property="og:description"
  content="2023-12-12 ES ILM Index Lifecycle Management 索引生命周期管理 (ILM) 是在 Elasticsearch 6.6（公测版）首次引入并在 6.7 版正式推出的一项功能。ILM 是 Elasticsearch 的一部分，主要用来管理索引 ​​ 标记节点属性" />
<meta property="og:url" content="https://renz7.github.io/post/20231212-es-ilm-z1idtm2.html" />
<meta property="og:site_name" content="2023-12-12 ES ILM" />
<meta property="og:image"
  content="https://renz7.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2023-12-12 10:08:02 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://renz7.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://renz7.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://renz7.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://renz7.github.io/">
                  <img class=" avatar-user"
                    src="https://renz7.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://renz7.github.io/">Renz7</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://renz7.github.io/post/20231212-es-ilm-z1idtm2.html">2023-12-12 ES ILM</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 12 Dec 2023 10:08:02 &#43;0000"
                    class="no-wrap">
                    Tue, 12 Dec 2023 10:08:02 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 12 Dec 2023 22:04:13 &#43;0000"
                    class="no-wrap">
                    Tue, 12 Dec 2023 22:04:13 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      805 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="2023-12-12-es-ilm">2023-12-12 ES ILM</h1>
<h1 id="index-lifecycle-management">Index Lifecycle Management</h1>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.0/index-lifecycle-management.html">索引生命周期管理 (ILM)</a> 是在 Elasticsearch 6.6（公测版）首次引入并在 6.7 版正式推出的一项功能。ILM 是 Elasticsearch 的一部分，主要用来管理索引</p>
<p>​<img src="https://raw.githubusercontent.com/Renz7/imagehost/main/siyuan/pic/202312122302015.png" alt="hot warm cold nodes">​</p>
<h3 id="标记节点属性">标记节点属性</h3>
<p>首先标记哪些节点是热节点、温节点和（可选）冷节点。此操作可以通过启动参数或在 elasticsearch.yml 配置文件中完成</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span> <span class="o">-</span><span class="n">Enode</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">hot</span>
</span></span><span class="line"><span class="cl"><span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span> <span class="o">-</span><span class="n">Enode</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">warm</span>
</span></span><span class="line"><span class="cl"><span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span> <span class="o">-</span><span class="n">Enode</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">cold</span>
</span></span></code></pre></div><h3 id="配置-ilm-策略">配置 ILM 策略</h3>
<p>ILM 策略分为四个主要阶段 - 热、温、冷和删除。</p>
<p>除了在热温冷节点之间移动数据外，还可以配置许多附加<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html">操作</a>。</p>
<ul>
<li>rollover <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-rollover-action">滚动更新操作</a>用于管理每个索引的大小或寿命。</li>
<li>forcemerge <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-forcemerge-action">强制合并</a>操作可用于优化索引。</li>
<li>freeze <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-freeze-action">冻结操作</a>可用于减少集群中的内存压力。</li>
</ul>
<p>操作步骤</p>
<ol>
<li>
<p>定义ILM</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PUT</span> <span class="o">/</span><span class="n">_ilm</span><span class="o">/</span><span class="n">policy</span><span class="o">/</span><span class="n">my_policy</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;policy&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;phases&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;hot&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;actions&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;rollover&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_size&#34;</span><span class="p">:</span><span class="s2">&#34;50gb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_age&#34;</span><span class="p">:</span><span class="s2">&#34;30d&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>‍</p>
</li>
<li>
<p>创建模板，使用ILM</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PUT</span> <span class="n">_template</span><span class="o">/</span><span class="n">my_template</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;index_patterns&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;test-*&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;index.lifecycle.name&#34;</span><span class="p">:</span> <span class="s2">&#34;my_policy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;index.lifecycle.rollover_alias&#34;</span><span class="p">:</span> <span class="s2">&#34;test-alias&#34;</span>  <span class="c1"># 注意：当在模板中使用滚动更新操作（而不是直接在索引上）指定 ILM 策略时，必须进行此关联。</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>索引数据</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PUT</span> <span class="n">test</span><span class="o">-</span><span class="mi">000001</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;aliases&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;test-alias&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;is_write_index&#34;</span><span class="p">:</span> <span class="n">true</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div></li>
</ol>
<h2 id="日志滚动示例">日志滚动示例</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PUT</span> <span class="n">_ilm</span><span class="o">/</span><span class="n">policy</span><span class="o">/</span><span class="n">hot</span><span class="o">-</span><span class="n">warm</span><span class="o">-</span><span class="n">cold</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="mi">60</span><span class="n">days</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;policy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;phases&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;hot&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;actions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;rollover&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_size&#34;</span><span class="p">:</span><span class="s2">&#34;50gb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_age&#34;</span><span class="p">:</span><span class="s2">&#34;30d&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;set_priority&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;priority&#34;</span><span class="p">:</span><span class="mi">50</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;warm&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;min_age&#34;</span><span class="p">:</span><span class="s2">&#34;7d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;actions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;forcemerge&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;max_num_segments&#34;</span><span class="p">:</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;shrink&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;number_of_shards&#34;</span><span class="p">:</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;allocate&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;require&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;warm&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;set_priority&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;priority&#34;</span><span class="p">:</span><span class="mi">25</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;cold&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;min_age&#34;</span><span class="p">:</span><span class="s2">&#34;30d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;actions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;set_priority&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;priority&#34;</span><span class="p">:</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;freeze&#34;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;allocate&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;require&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="s2">&#34;cold&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;delete&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;min_age&#34;</span><span class="p">:</span><span class="s2">&#34;60d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;actions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;delete&#34;</span><span class="p">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="热">热</h3>
<p>这个 ILM 策略首先会将<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/recovery-prioritization.html">索引优先级</a>设置为一个较高的值，以便热索引在其他索引之前恢复。30 天后或达到 50GB 时（符合任何一个即可），该索引将滚动更新，系统将创建一个新索引。该新索引将重新启动策略，而当前的索引（刚刚滚动更新的索引）将在滚动更新后等待 7 天再进入温阶段。</p>
<h3 id="温">温</h3>
<p>索引进入温阶段后，ILM 会将索引<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-shrink-action">收缩</a>到 1 个分片，将索引<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-forcemerge-action">强制合并</a>为 1 个段，并将<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-set-priority-action">索引优先级设置</a>为比热阶段低（但比冷阶段高）的值，通过<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-allocate-action">分配</a>操作将索引移动到温节点。完成该操作后，索引将等待 30 天（从滚动更新时算起）后进入冷阶段。</p>
<h3 id="冷">冷</h3>
<p>索引进入冷阶段后，ILM 将再次降低<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-set-priority-action">索引优先级</a>，以确保热索引和温索引得到先行恢复。然后，ILM 将<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/_actions.html#ilm-freeze-action">冻结</a>索引并将其移动到冷节点。完成该操作后，索引将等待 60 天（从滚动更新时算起）后进入删除阶段。</p>
<h3 id="删除">删除</h3>
<p>在删除阶段，始终需要有一个 <code>min_age</code>​ 条件，以允许索引在给定时段内待在热、温或冷阶段。</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://renz7.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://renz7.github.io/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://renz7.github.io/css/gitalk.css'>
<script src='https://renz7.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'e82b43a7dc240d5cb4bb',
    clientSecret: '565d40b4ee93c33c90a8b6005a805777c693c3b2',
    repo: 'Renz7.github.io',
    owner: 'renz7',
    admin: ['renz7'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://renz7.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://renz7.github.io/js/github-style.js"></script>




</html>